<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#20B2AA">
    <title>FitMoments - Track Your Fitness</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRml0TW9tZW50cyIsInNob3J0X25hbWUiOiJGaXRNb21lbnRzIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYiLCJ0aGVtZV9jb2xvciI6IiMyMEIyQUEiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRreUlpQm9aV2xuYUhROUlqRTVNaUlnZG1sbGQwSnZlRDBpTUNBd0lERTVNaUF4T1RJaUlHWnBiR3c5SW01dmJtVWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStQSEpsWTNRZ2QybGtkR2c5SWpFNU1pSWdhR1ZwWjJoMFBTSXhPVElpSUdacGJHdzlJaU15TUVJeVFVRWlMejQ4Y0dGMGFDQmtQU0pOT1RZZ05EaE1OVFFJT0RRZ09EUk1PRFFnTlRSTU5UUWdPRFJNTlRRZ01UQTBNVEF3SURFd05FRXhNaUF4TWlBd0lEQWdNU0EyTkNBNU5rRXhNaUF4TWlBd0lEQWdNU0E1TmlBME9Gb3lJaUJtYVd4c1BTSWpabVptSWk4K1BDOXpkbWMrIiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #abe6f6 0%, #33e0b2 100%);
            min-height: 100vh;
            padding-bottom: 80px;
            transition: background 0.3s ease;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        .container-fluid {
            max-width: 1200px;
        }
        
        /* Header */
        .app-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .dark-mode .app-header {
            background: rgba(26, 40, 78, 0.95);
            color: #fff;
        }
        
        .app-title {
            font-weight: 700;
            color: #20B2AA;
            font-size: 1.5rem;
        }
        
        .dark-mode .app-title {
            color: #4fd1c5;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 0;
            box-shadow: 0 -2px 20px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .dark-mode .bottom-nav {
            background: rgba(22, 33, 62, 0.95);
        }
        
        .nav-item-custom {
            text-align: center;
            color: #6c757d;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .nav-item-custom i {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 5px;
        }
        
        .nav-item-custom span {
            font-size: 0.75rem;
            display: block;
        }
        
        .nav-item-custom.active {
            color: #20B2AA;
        }
        
        .dark-mode .nav-item-custom.active {
            color: #4fd1c5;
        }
        
        /* Cards */
        .card {
            border-radius: 20px;
            border: none;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .dark-mode .card {
            background: #1a1a2e;
            color: #fff;
        }
        
        /* Stats Cards */
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        
        .stat-card h3 {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .stat-card p {
            margin: 0;
            opacity: 0.9;
        }
        
        /* Gallery Grid */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .gallery-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            aspect-ratio: 1;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .gallery-item img, .gallery-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .gallery-item .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .gallery-item .activity-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
            padding: 10px;
            font-size: 0.85rem;
        }
        
        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .fab-btn {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 1.5rem;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            z-index: 999;
            transition: all 0.3s;
        }
        
        .fab-btn:hover {
            transform: scale(1.1);
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
        }
        
        .spinner-border {
            color: #20B2AA;
        }
        
        /* Profile */
        .profile-header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            margin-bottom: 20px;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid white;
            object-fit: cover;
            margin-bottom: 15px;
        }
        
        /* Modal */
        .modal-content {
            border-radius: 20px;
        }
        
        .dark-mode .modal-content {
            background: #1a1a2e;
            color: #fff;
        }
        
        /* Page */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Form */
        .form-control, .form-select {
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            padding: 12px;
        }
        
        .dark-mode .form-control, .dark-mode .form-select {
            background: #16213e;
            border-color: #4fd1c5;
            color: #fff;
        }
        
        /* Search */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-box input {
            padding-left: 45px;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="app-header">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="app-title mb-0">
                        <i class="bi bi-lightning-charge-fill"></i> FitMoments
                    </h1>
                </div>
                <div>
                    <button class="btn btn-link" id="darkModeToggle">
                        <i class="bi bi-moon-fill" style="font-size: 1.5rem; color: #20B2AA;"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page active">
            <h2 class="text-white mb-4">Dashboard</h2>
            
            <div class="row">
                <div class="col-md-4 col-6">
                    <div class="stat-card">
                        <h3 id="totalActivities">0</h3>
                        <p>Total Aktivitas</p>
                    </div>
                </div>
                <div class="col-md-4 col-6">
                    <div class="stat-card">
                        <h3 id="monthlyActivities">0</h3>
                        <p>Bulan Ini</p>
                    </div>
                </div>
                <div class="col-md-4 col-12">
                    <div class="stat-card">
                        <h3 id="totalDuration">0</h3>
                        <p>Total Durasi (menit)</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Aktivitas Terbaru</h5>
                    <div id="recentActivities"></div>
                </div>
            </div>
        </div>

        <!-- Gallery Page -->
        <div id="galleryPage" class="page">
            <h2 class="text-white mb-4">Galeri Aktivitas</h2>
            
            <div class="search-box">
                <i class="bi bi-search"></i>
                <input type="text" class="form-control" id="searchInput" placeholder="Cari aktivitas...">
            </div>
            
            <div id="galleryContainer"></div>
        </div>

        <!-- Profile Page -->
        <div id="profilePage" class="page">
            <div class="profile-header">
                <div style="position: relative; display: inline-block;">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23fff'/%3E%3Cpath d='M50 45c8.284 0 15-6.716 15-15s-6.716-15-15-15-15 6.716-15 15 6.716 15 15 15zM50 50c-16.569 0-30 13.431-30 30h60c0-16.569-13.431-30-30-30z' fill='%2320B2AA'/%3E%3C/svg%3E" class="profile-avatar" id="profileAvatar" alt="Profile">
                    <button class="btn btn-light btn-sm" onclick="changeProfilePhoto()" style="position: absolute; bottom: 0; right: -10px; border-radius: 50%; width: 35px; height: 35px; padding: 0; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
                        <i class="bi bi-camera-fill"></i>
                    </button>
                </div>
                <h3 id="userName">Pengguna FitMoments</h3>
                <button class="btn btn-light btn-sm mt-2" onclick="editProfile()">
                    <i class="bi bi-pencil"></i> Edit Profil
                </button>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Statistik Bulanan</h5>
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Jenis Olahraga Favorit</h5>
                    <div id="favoriteSports"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- FAB Button -->
    <button class="fab-btn" onclick="showUploadModal()">
        <i class="bi bi-plus-lg"></i>
    </button>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="container-fluid">
            <div class="row">
                <div class="col-4">
                    <a href="#" class="nav-item-custom active" onclick="showPage('dashboard')">
                        <i class="bi bi-house-door-fill"></i>
                        <span>Beranda</span>
                    </a>
                </div>
                <div class="col-4">
                    <a href="#" class="nav-item-custom" onclick="showPage('gallery')">
                        <i class="bi bi-grid-fill"></i>
                        <span>Galeri</span>
                    </a>
                </div>
                <div class="col-4">
                    <a href="#" class="nav-item-custom" onclick="showPage('profile')">
                        <i class="bi bi-person-fill"></i>
                        <span>Profil</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Upload Aktivitas</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadForm">
                        <div class="mb-3">
                            <label class="form-label">Foto/Video</label>
                            <input type="file" class="form-control" id="mediaInput" accept="image/*,video/*" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Jenis Olahraga</label>
                            <select class="form-select" id="sportType" required>
                                <option value="">Pilih Jenis Olahraga</option>
                                <option value="Lari">Lari</option>
                                <option value="Bersepeda">Bersepeda</option>
                                <option value="Renang">Renang</option>
                                <option value="Gym">Gym</option>
                                <option value="Yoga">Yoga</option>
                                <option value="Senam">Senam</option>
                                <option value="Futsal">Futsal</option>
                                <option value="Basket">Basket</option>
                                <option value="Badminton">Badminton</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Durasi (menit)</label>
                            <input type="number" class="form-control" id="duration" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Deskripsi</label>
                            <textarea class="form-control" id="description" rows="3" placeholder="Ceritakan aktivitasmu..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-cloud-upload"></i> Unggah
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal fade" id="detailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detail Aktivitas</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="detailContent"></div>
                <div class="modal-footer">
                    <button class="btn btn-warning" onclick="editActivity()">
                        <i class="bi bi-pencil"></i> Edit
                    </button>
                    <button class="btn btn-danger" onclick="confirmDelete()">
                        <i class="bi bi-trash"></i> Hapus
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Aktivitas</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editId">
                        <div class="mb-3">
                            <label class="form-label">Jenis Olahraga</label>
                            <select class="form-select" id="editSportType" required>
                                <option value="Lari">Lari</option>
                                <option value="Bersepeda">Bersepeda</option>
                                <option value="Renang">Renang</option>
                                <option value="Gym">Gym</option>
                                <option value="Yoga">Yoga</option>
                                <option value="Senam">Senam</option>
                                <option value="Futsal">Futsal</option>
                                <option value="Basket">Basket</option>
                                <option value="Badminton">Badminton</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Durasi (menit)</label>
                            <input type="number" class="form-control" id="editDuration" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Deskripsi</label>
                            <textarea class="form-control" id="editDescription" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-save"></i> Simpan Perubahan
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Edit Modal -->
    <div class="modal fade" id="profileEditModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Profil</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="profileEditForm">
                        <div class="mb-3">
                            <label class="form-label">Nama</label>
                            <input type="text" class="form-control" id="editUserName" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-save"></i> Simpan
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Photo Modal -->
    <div class="modal fade" id="profilePhotoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ubah Foto Profil</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="file" id="profilePhotoInput" accept="image/*" style="display: none;">
                    <div class="text-center mb-3">
                        <img id="profilePhotoPreview" src="" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; display: none; margin-bottom: 15px;">
                    </div>
                    <button class="btn btn-primary w-100 mb-2" onclick="document.getElementById('profilePhotoInput').click()">
                        <i class="bi bi-image"></i> Pilih Foto
                    </button>
                    <button class="btn btn-success w-100" id="saveProfilePhoto" style="display: none;">
                        <i class="bi bi-check-lg"></i> Simpan Foto
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Konfirmasi Hapus</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Apakah Anda yakin ingin menghapus aktivitas ini?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" onclick="deleteActivity()">Ya, Hapus</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/4.4.0/chart.umd.min.js"></script>
    
    <script>
        // Initialize
        let activities = JSON.parse(localStorage.getItem('fitmoments_activities')) || [];
        let currentActivityId = null;
        let myChart = null;
        
        // Dark Mode
        const darkModeToggle = document.getElementById('darkModeToggle');
        const isDarkMode = localStorage.getItem('fitmoments_darkmode') === 'true';
        
        if (isDarkMode) {
            document.body.classList.add('dark-mode');
            darkModeToggle.innerHTML = '<i class="bi bi-sun-fill" style="font-size: 1.5rem; color: #ffd700;"></i>';
        }
        
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('fitmoments_darkmode', isDark);
            darkModeToggle.innerHTML = isDark ? 
                '<i class="bi bi-sun-fill" style="font-size: 1.5rem; color: #ffd700;"></i>' : 
                '<i class="bi bi-moon-fill" style="font-size: 1.5rem; color: #20B2AA;"></i>';
        });
        
        // Page Navigation
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item-custom').forEach(n => n.classList.remove('active'));
            
            document.getElementById(page + 'Page').classList.add('active');
            event.target.closest('.nav-item-custom').classList.add('active');
            
            if (page === 'dashboard') updateDashboard();
            if (page === 'gallery') updateGallery();
            if (page === 'profile') updateProfile();
        }
        
        // Upload Modal
        function showUploadModal() {
            new bootstrap.Modal(document.getElementById('uploadModal')).show();
        }
        
        // Upload Form Submit
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const mediaInput = document.getElementById('mediaInput');
            const sportType = document.getElementById('sportType').value;
            const duration = document.getElementById('duration').value;
            const description = document.getElementById('description').value;
            
            if (mediaInput.files.length === 0) return;
            
            const file = mediaInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const activity = {
                    id: Date.now(),
                    media: e.target.result,
                    mediaType: file.type.startsWith('video') ? 'video' : 'image',
                    sportType,
                    duration: parseInt(duration),
                    description,
                    date: new Date().toISOString()
                };
                
                activities.unshift(activity);
                localStorage.setItem('fitmoments_activities', JSON.stringify(activities));
                
                bootstrap.Modal.getInstance(document.getElementById('uploadModal')).hide();
                document.getElementById('uploadForm').reset();
                
                updateDashboard();
                updateGallery();
                
                // Show success message
                alert('Aktivitas berhasil ditambahkan!');
            };
            
            reader.readAsDataURL(file);
        });
        
        // Update Dashboard
        function updateDashboard() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const monthlyActivities = activities.filter(a => {
                const actDate = new Date(a.date);
                return actDate.getMonth() === currentMonth && actDate.getFullYear() === currentYear;
            });
            
            const totalDuration = activities.reduce((sum, a) => sum + a.duration, 0);
            
            document.getElementById('totalActivities').textContent = activities.length;
            document.getElementById('monthlyActivities').textContent = monthlyActivities.length;
            document.getElementById('totalDuration').textContent = totalDuration;
            
            // Recent Activities
            const recentContainer = document.getElementById('recentActivities');
            if (activities.length === 0) {
                recentContainer.innerHTML = '<div class="empty-state"><i class="bi bi-inbox"></i><p>Belum ada aktivitas</p></div>';
            } else {
                const recent = activities.slice(0, 5);
                recentContainer.innerHTML = recent.map(a => `
                    <div class="d-flex align-items-center mb-3 pb-3 border-bottom" style="cursor: pointer;" onclick="showDetail(${a.id})">
                        <div class="me-3">
                            ${a.mediaType === 'video' ? 
                                `<video src="${a.media}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 10px;"></video>` :
                                `<img src="${a.media}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 10px;">`
                            }
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1">${a.sportType}</h6>
                            <small class="text-muted">${a.duration} menit â€¢ ${formatDate(a.date)}</small>
                        </div>
                        <i class="bi bi-chevron-right"></i>
                    </div>
                `).join('');
            }
        }
        
        // Update Gallery
        function updateGallery() {
            const container = document.getElementById('galleryContainer');
            
            if (activities.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="bi bi-images"></i><p>Belum ada aktivitas di galeri</p></div>';
                return;
            }
            
            const galleryHTML = `
                <div class="gallery-grid">
                    ${activities.map(a => `
                        <div class="gallery-item" onclick="showDetail(${a.id})">
                            ${a.mediaType === 'video' ? 
                                `<video src="${a.media}"></video>
                                <i class="bi bi-play-circle-fill play-icon"></i>` :
                                `<img src="${a.media}">`
                            }
                            <div class="activity-label">
                                <strong>${a.sportType}</strong><br>
                                <small>${a.duration} menit</small>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = galleryHTML;
        }
        
        // Search Activities
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filtered = activities.filter(a => 
                a.sportType.toLowerCase().includes(searchTerm) ||
                a.description.toLowerCase().includes(searchTerm)
            );
            
            const container = document.getElementById('galleryContainer');
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="bi bi-search"></i><p>Tidak ada hasil pencarian</p></div>';
                return;
            }
            
            const galleryHTML = `
                <div class="gallery-grid">
                    ${filtered.map(a => `
                        <div class="gallery-item" onclick="showDetail(${a.id})">
                            ${a.mediaType === 'video' ? 
                                `<video src="${a.media}"></video>
                                <i class="bi bi-play-circle-fill play-icon"></i>` :
                                `<img src="${a.media}">`
                            }
                            <div class="activity-label">
                                <strong>${a.sportType}</strong><br>
                                <small>${a.duration} menit</small>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = galleryHTML;
        });
        
        // Show Detail
        function showDetail(id) {
            const activity = activities.find(a => a.id === id);
            if (!activity) return;
            
            currentActivityId = id;
            
            const content = `
                <div class="text-center mb-3">
                    ${activity.mediaType === 'video' ? 
                        `<video src="${activity.media}" controls style="width: 100%; max-height: 300px; border-radius: 15px;"></video>` :
                        `<img src="${activity.media}" style="width: 100%; max-height: 300px; object-fit: cover; border-radius: 15px;">`
                    }
                </div>
                <h5><i class="bi bi-trophy"></i> ${activity.sportType}</h5>
                <p><i class="bi bi-clock"></i> Durasi: ${activity.duration} menit</p>
                <p><i class="bi bi-calendar"></i> Tanggal: ${formatDate(activity.date)}</p>
                <p><i class="bi bi-chat-left-text"></i> ${activity.description || 'Tidak ada deskripsi'}</p>
            `;
            
            document.getElementById('detailContent').innerHTML = content;
            new bootstrap.Modal(document.getElementById('detailModal')).show();
        }
        
        // Edit Activity
        function editActivity() {
            const activity = activities.find(a => a.id === currentActivityId);
            if (!activity) return;
            
            document.getElementById('editId').value = activity.id;
            document.getElementById('editSportType').value = activity.sportType;
            document.getElementById('editDuration').value = activity.duration;
            document.getElementById('editDescription').value = activity.description;
            
            bootstrap.Modal.getInstance(document.getElementById('detailModal')).hide();
            new bootstrap.Modal(document.getElementById('editModal')).show();
        }
        
        // Edit Form Submit
        document.getElementById('editForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('editId').value);
            const sportType = document.getElementById('editSportType').value;
            const duration = parseInt(document.getElementById('editDuration').value);
            const description = document.getElementById('editDescription').value;
            
            const index = activities.findIndex(a => a.id === id);
            if (index !== -1) {
                activities[index].sportType = sportType;
                activities[index].duration = duration;
                activities[index].description = description;
                
                localStorage.setItem('fitmoments_activities', JSON.stringify(activities));
                
                bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                
                updateDashboard();
                updateGallery();
                
                alert('Aktivitas berhasil diupdate!');
            }
        });
        
        // Confirm Delete
        function confirmDelete() {
            bootstrap.Modal.getInstance(document.getElementById('detailModal')).hide();
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        }
        
        // Delete Activity
        function deleteActivity() {
            activities = activities.filter(a => a.id !== currentActivityId);
            localStorage.setItem('fitmoments_activities', JSON.stringify(activities));
            
            bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
            
            updateDashboard();
            updateGallery();
            
            alert('Aktivitas berhasil dihapus!');
        }
        
        // Update Profile
        function updateProfile() {
            const userName = localStorage.getItem('fitmoments_username') || 'Pengguna FitMoments';
            document.getElementById('userName').textContent = userName;
            
            // Load profile photo
            const profilePhoto = localStorage.getItem('fitmoments_profile_photo');
            if (profilePhoto) {
                document.getElementById('profileAvatar').src = profilePhoto;
            }
            
            // Monthly Chart
            const ctx = document.getElementById('monthlyChart');
            
            // Get last 6 months data
            const monthsData = [];
            const now = new Date();
            
            for (let i = 5; i >= 0; i--) {
                const month = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const monthName = month.toLocaleDateString('id-ID', { month: 'short' });
                
                const count = activities.filter(a => {
                    const actDate = new Date(a.date);
                    return actDate.getMonth() === month.getMonth() && 
                           actDate.getFullYear() === month.getFullYear();
                }).length;
                
                monthsData.push({ month: monthName, count });
            }
            
            if (myChart) {
                myChart.destroy();
            }
            
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthsData.map(d => d.month),
                    datasets: [{
                        label: 'Jumlah Aktivitas',
                        data: monthsData.map(d => d.count),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        borderRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            // Favorite Sports
            const sportCounts = {};
            activities.forEach(a => {
                sportCounts[a.sportType] = (sportCounts[a.sportType] || 0) + 1;
            });
            
            const sorted = Object.entries(sportCounts).sort((a, b) => b[1] - a[1]).slice(0, 5);
            
            const favContainer = document.getElementById('favoriteSports');
            
            if (sorted.length === 0) {
                favContainer.innerHTML = '<p class="text-muted">Belum ada data olahraga</p>';
            } else {
                favContainer.innerHTML = sorted.map(([sport, count]) => `
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span><i class="bi bi-star-fill text-warning"></i> ${sport}</span>
                        <span class="badge bg-primary">${count}x</span>
                    </div>
                `).join('');
            }
        }
        
        // Edit Profile
        function editProfile() {
            const userName = localStorage.getItem('fitmoments_username') || 'Pengguna FitMoments';
            document.getElementById('editUserName').value = userName;
            new bootstrap.Modal(document.getElementById('profileEditModal')).show();
        }
        
        // Change Profile Photo
        function changeProfilePhoto() {
            new bootstrap.Modal(document.getElementById('profilePhotoModal')).show();
        }
        
        // Profile Photo Input Change
        document.getElementById('profilePhotoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const preview = document.getElementById('profilePhotoPreview');
                preview.src = event.target.result;
                preview.style.display = 'block';
                document.getElementById('saveProfilePhoto').style.display = 'block';
            };
            reader.readAsDataURL(file);
        });
        
        // Save Profile Photo
        document.getElementById('saveProfilePhoto').addEventListener('click', function() {
            const preview = document.getElementById('profilePhotoPreview');
            const photoData = preview.src;
            
            localStorage.setItem('fitmoments_profile_photo', photoData);
            document.getElementById('profileAvatar').src = photoData;
            
            bootstrap.Modal.getInstance(document.getElementById('profilePhotoModal')).hide();
            
            // Reset modal
            document.getElementById('profilePhotoInput').value = '';
            preview.style.display = 'none';
            this.style.display = 'none';
            
            alert('Foto profil berhasil diubah!');
        });
        
        // Profile Edit Form Submit
        document.getElementById('profileEditForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const userName = document.getElementById('editUserName').value;
            localStorage.setItem('fitmoments_username', userName);
            
            document.getElementById('userName').textContent = userName;
            
            bootstrap.Modal.getInstance(document.getElementById('profileEditModal')).hide();
            
            alert('Profil berhasil diupdate!');
        });
        
        // Format Date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            });
        }
        
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZnVuY3Rpb24oZXZlbnQpIHsKICBldmVudC53YWl0VW50aWwoCiAgICBjYWNoZXMub3BlbignZml0bW9tZW50cy12MScpLnRoZW4oZnVuY3Rpb24oY2FjaGUpIHsKICAgICAgcmV0dXJuIGNhY2hlLmFkZEFsbChbJy8nXSk7CiAgICB9KQogICk7Cn0pOwoKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgZXZlbnQucmVzcG9uZFdpdGgoCiAgICBjYWNoZXMubWF0Y2goZXZlbnQucmVxdWVzdCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICByZXR1cm4gcmVzcG9uc2UgfHwgZmV0Y2goZXZlbnQucmVxdWVzdCk7CiAgICB9KQogICk7Cn0pOw==')
                .then(() => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed:', err));
        }
        
        // Initialize App
        updateDashboard();
    </script>
</body>
</html>